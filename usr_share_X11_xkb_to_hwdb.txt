XKB settings（/usr/share/X11/xkb/symbols/inet） only change event.key(keysyms in sudo xkbcli interactive-evdev) and won't change event.code(keycode in sudo xkbcli interactive-evdev)，some web application will catch the original key code and re-emit original event.

For example in some customize monaco editor(google IDX development environment), if I remapped right-arrow key into right-control key(

    key <RGHT> {         [       Control_R ] };

in /usr/share/X11/xkb/symbols/inet), the google idx will re-emit a controlRight and a arrowRight, they happen to be a keyboard shortcut(word jumping).

So I shouldn't use xkb symbols file, and I shouldn't use "sudo setkeycodes e04d 97" ("sudo showkey -s" get "e04d" for right-arrow),
it will show error for usb keyboard: "setkeycodes: failed to set scancode cd to keycode 97: ioctl KDSETKEYCODE: Invalid argument",
I can only use /etc/udev/hwdb.d/10-myboard.hwdb(or /usr/lib/udev/hwdb.d/10-myboard.hwdb):

    evdev:input:b0003v046Dp4024*
     KEYBOARD_KEY_7004f=97

"7004f" is the rightArrow scancode in "sudo evtest /dev/input/event?".
"97" or "KEY_RIGHTCTRL" is from the "sudo evtest" or "grep -i right /usr/include/linux/input-event-codes.h"

and then exec:

    sudo systemd-hwdb update ; sudo udevadm control --reload-rules ;sudo udevadm trigger


finally, test it with "sudo evtest", and the key code has been changed from 106 to 97. And the problem in google IDX monaco editor has been resolved.

scancode(7004f, KeyboardRightArrow) --> keycode(106, KEY_RIGHT) --> keysyms(97, Control_R)

linux内核默认映射scancode --> keycode, 例如: 7004f(KeyboardRightArrow) --> 106(KEY_RIGHT)
linux内核默认映射代码: https://github.com/torvalds/linux/blob/master/drivers/hid/hid-input.c 里面的 static const unsigned char hid_keyboard[256] = { ... } 映射表
比如 hid_keyboard[256] 第5行第16列 编号就是4f, 则scancode就是7004f, 映射表该位置的值是十进制的106就是keycode
ref:
scancode名称可以查: https://github.com/torvalds/linux/blob/master/drivers/hid/hid-debug.c#L380
{ 0x07, 0x004f, "KeyboardRightArrow" },
keycode名称可以查: grep -i 106 /usr/include/linux/input-event-codes.h
#define KEY_RIGHT		106

cat ./showkeys.sh:
#!/bin/bash

# 定义一个函数来清理进程
cleanup() {
    echo "正在停止 xkbcli 和 evtest..."
    sudo pkill -f "xkbcli interactive-evdev"
    sudo pkill -f "evtest /dev/input/event4"
    rm a.log
    exit 0
}

# 设置 trap 来捕获 SIGINT (Ctrl+C)
trap cleanup SIGINT

# 启动 xkbcli 和 evtest
sudo stdbuf -oL xkbcli interactive-evdev >> a.log 2>&1 &
sudo evtest /dev/input/event4 >> a.log 2>&1 &

# 实时处理并显示日志
tail -f a.log | awk '
    /keysyms/ {
        if ($5 == "keysyms") {
            keysyms = $7
        } else if ($8 == "keysyms") {
            keysyms = $10
        }
    }
    /MSC_SCAN/ {
        scancode = $NF
    }
    /EV_KEY/ {
        keycode = $8
        keycode_name= $9
        sub(/,/, "", keycode_name)
        sub(/\(/, "", keycode_name)
        sub(/\)/, "", keycode_name)
        if ($11 == "1") {
            action = "↓"
        } else if ($11 == "0") {
            action = "↑"
        }

        printf "scancode: %s, keycode: %s(%s), keysyms: %s, action: %s\n", scancode, keycode, keycode_name, keysyms, action
        keysyms=""
        scancode=""
        keycode=""
        keycode_name=""
        action=""
    }
'

# 等待子进程结束
wait
